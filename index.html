<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Investment Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; color: #2c3e50; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { grid-column: span 2; padding: 12px; background: #001935; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; }
        button:hover { background: #003366; }
        .chart-container { position: relative; height: 400px; width: 100%; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #001935; color: white; padding: 10px; font-size: 13px; }
        td { border: 1px solid #eee; padding: 10px; text-align: center; font-size: 13px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin-top:0; color:#001935;">Monte Carlo Growth Simulator</h2>
    
    <div class="controls">
        <div>
            <label>Initial Principal ($)</label>
            <input type="number" id="p" value="100000">
        </div>
        <div>
            <label>Annual Contribution ($)</label>
            <input type="number" id="c" value="10000">
        </div>
        <div>
            <label>Expected Return (%)</label>
            <input type="number" id="r" value="7" step="0.5">
        </div>
        <div>
            <label>Volatility/Risk (SD %)</label>
            <input type="number" id="sd" value="12">
        </div>
        <div>
            <label>Inflation (%)</label>
            <input type="number" id="infl" value="2.5">
        </div>
        <div>
            <label>Years</label>
            <input type="number" id="y" value="25">
        </div>
        <button onclick="runSimulation()">Run Simulation</button>
    </div>

    <div class="chart-container">
        <canvas id="growthChart"></canvas>
    </div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>Year</th>
                <th>Conservative (P10)</th>
                <th>Median (P50)</th>
                <th>Aggressive (P90)</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
let myChart;

// Normal distribution random generator (Box-Muller)
function rnorm(mean, sd) {
    let u = 0, v = 0;
    while(u === 0) u = Math.random();
    while(v === 0) v = Math.random();
    return mean + sd * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

function runSimulation() {
    const P = parseFloat(document.getElementById('p').value);
    const C = parseFloat(document.getElementById('c').value);
    const R = parseFloat(document.getElementById('r').value) / 100;
    const SD = parseFloat(document.getElementById('sd').value) / 100;
    const INFL = parseFloat(document.getElementById('infl').value) / 100;
    const years = parseInt(document.getElementById('y').value);
    const n_sims = 1000;

    let results = Array.from({ length: years + 1 }, () => []);

    for (let s = 0; s < n_sims; s++) {
        let currentBalance = P;
        results[0].push(currentBalance);
        for (let t = 1; t <= years; t++) {
            let annualReturn = rnorm(R, SD);
            currentBalance = (currentBalance * (1 + annualReturn)) + C;
            // Adjust for inflation
            let realValue = currentBalance / Math.pow(1 + INFL, t);
            results[t].push(realValue);
        }
    }

    let labels = [], p10 = [], p50 = [], p90 = [];
    let tableBody = "";

    for (let t = 0; t <= years; t++) {
        results[t].sort((a, b) => a - b);
        labels.push("Yr " + t);
        p10.push(results[t][Math.floor(n_sims * 0.1)]);
        p50.push(results[t][Math.floor(n_sims * 0.5)]);
        p90.push(results[t][Math.floor(n_sims * 0.9)]);

        if (t % 5 === 0 || t === years) {
            tableBody += `<tr>
                <td>${t}</td>
                <td>$${Math.round(p10[t]).toLocaleString()}</td>
                <td>$${Math.round(p50[t]).toLocaleString()}</td>
                <td>$${Math.round(p90[t]).toLocaleString()}</td>
            </tr>`;
        }
    }

    document.querySelector("#dataTable tbody").innerHTML = tableBody;

    if (myChart) myChart.destroy();
    const ctx = document.getElementById('growthChart').getContext('2d');
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Median', data: p50, borderColor: '#001935', fill: false, borderWidth: 3 },
                { label: 'P90 (Aggressive)', data: p90, borderColor: 'rgba(52, 152, 219, 0.3)', backgroundColor: 'rgba(52, 152, 219, 0.1)', fill: 1, pointRadius: 0 },
                { label: 'P10 (Conservative)', data: p10, borderColor: 'rgba(52, 152, 219, 0.3)', pointRadius: 0, fill: false }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { tooltip: { mode: 'index', intersect: false } },
            scales: { y: { ticks: { callback: v => '$' + v.toLocaleString() } } }
        }
    });
}

window.onload = runSimulation;
</script>

</body>
</html>
